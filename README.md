## Проектная работа на тему

# Многопоточное интегрирование функций одной переменной методом Монте-Карло

## Предыстория

В наш замечательный НИИЧАВО завезли новый сервер с большим числом вычислительных ядер. Все сотрудники в восторге! Каждый мечтает на этом замечательном сервере интегрировать все подряд. Заодно пользователи просят добавить возможность использовать сервер в качестве онлайн калькулятора, поскольку бывает удобно в процессе работы отправлять вычисление значения функции в некоторой точке на удаленную машину.

Мудрое начальство поручило создать серверное ПО для обработки входящих TCP соединений от пользователей, содержащих запросы на вычисление, а также асинхронную обработку этих запросов. 

Главная цель - возможность одновременно запускать много запросов на вычисление и возвращать пользователям ответ в виде строки (строка может быть либо результатом вычисления, либо сообщением об ошибке).

## Требования к проекту

Проект должен состоять из библиотечного модуля для многопоточного интегрирования методом Монте-Карло заданной функции одной переменной и серверной части для приема запросов от клиентов. Предполагается вычисление собственного интеграла, и несобственное интегрирование с одним бесконечным пределом интегрирования (*сотрудники НИИ достаточны умны чтобы разбить интеграл с двумя бесконечными предалами либо интеграл с сингулярной точкой на два интеграла или более*).

В main представлено создание tcp-сервера который может принимать от клиентов в текстовом виде строку с описанием функции одной переменной, переменная именуется как х, парсер должен поддерживать стандартный набор функций от одной переменной:

```
+,-,*,/,^,sin,cos,tg,ctg,atan,actg,e^
```

Должны поддерживаться стандартные константы e и pi.

При использовании в качестве библиотечного модуля пользователь может задавать как строку с записью функции, так и объект с оператором () для вызова заданной функции. Возвращаемое значение double у функционального объекта.

## Цели проекта

1) Закрепить работу с boost::asio для обработки TCP соединений;
2) Освоить работу с boost::thread_pool для многопоточной обработки данных на примере интегрирования методом Монте-Карло;

## Архитектура

Проект состоит из следующих крупных модулей:

1) Модуль обработки текстового выражения и превращения в объект с возможностью вычисления значения в некоторой заданной точке (Parser);

2) Модуль многопоточного интегрирования для заданной функции одной переменной (объекта с оператором () и единственным входным аргументом типа double);

3) Модуль обработки входящих TCP соединений, получения запросов определенной структуры и возвращения ответа на запрос (результата вычисления либо сообщения об ошибке).

## Протокол взаимодействия с пользователем через tcp

В открытом tcp соединении на котором слушает сервер пользователь может отправлять 3 типа строковых запросов:

1) Режим простого калькулятора - пользователь задает функцию от ондой переменной и точку, на которой нужно вычислить значение.

Протокол ввода:

```
function(x);x
```

Возвращаемое значение: строка с результатом вычисления либо сообщением об ошибке.

Пример:

```
ipnut: e^x+3*x-2;1

output: 3.718282
```

2) Режим интегрирования заданной функции в указанном отрезке\интервале с фиксированным числом точек для испытаний Монте-Карло.

Протокол ввода:

```
0   ; f(x)  ; a     ;   b   ;num_points;num_workers
```
Возвращаемое значение: строка с результатом вычисления либо сообщением об ошибке.

Пример:

```
input: 0;3*x+x^2;0;2;10000000;4
output: 8.670044
```

3) Режим интегрирования заданной функции в указанном отрезке\интервале с фиксированной дисперсией ответа для испытаний Монте-Карло.

Протокол ввода:

```
1   ; f(x)  ; a     ;   b   ;dispersion;num_workers
```
Возвращаемое значение: строка с результатом вычисления либо сообщением об ошибке.

Пример:

```
1;3*x+x^2;0;2;0.0001;10
8.674592
```

#### Для режимов 2 и 3 поддерживается бесконечная верхняя или нижняя граница интегрирования (задается ключевым словом inf). 

Пример:
```
input: 0;e^x;-inf;0;10000000;10
output: 1.000201
```

Пользователь может задать отрезок интегрирования + либо указать число точек, либо указать примерную дисперсию для оценки интеграла, программа тогда сама расчитывает число испытаний. 

Максимальное количество потоков под каждый запрос определяется при старте сервера, либо определяется исходя из числа ядер в системе.

В main.cpp содержится пример запуска сервера, а также (под комментариями) присутствуют примеры прямого обращения к модулям приложения.

Boost тесты для базового функицонала всех модулей можно найти в файле test_vesrion.cpp.
