# 11. Outer join

Условие

Разработать асинхронный сервер выполняющий операции пересечения и симметрической разницы над множествами.

Внутренняя реализация должна предоставить возможность работать с двумя таблицами идентичной и фиксированной структуры. Одна таблица имеет название A, вторая - B и общую структуру:

{

int id;

std::string name;

}

id является первичным ключом и не может дублироваться в одной таблице.

Для содержимого таблицы A:

id | name

---+----------

0 | lean

1 | sweater

2 | frank

3 | violation

4 | quality

5 | precision

и содержимого таблицы B:

id | name

---+----------

3 | proposal

4 | example

5 | lake

6 | flour

7 | wonder

8 | selection

Необходимо уметь формировать пересечение данных из двух таблиц в виде коллекции:

id | A | B

---+-----------+---------

3 | violation | proposal

4 | quality | example

5 | precision | lake

Необходимо уметь формировать симметрическую разность данных из двух таблиц в виде коллекции:

id | A | B

---+-----------+---------

0 | lean |

1 | sweater |

2 | frank |

6 | | flour

7 | | wonder

8 | | selection

Строки должны следовать в порядке возрастания поля id. Для пополнения коллекции и выполнения операций над множествами необходимо реализовать следующий протокол:

INSERT table id name

TRUNCATE table

INTERSECTION

SYMMETRIC_DIFFERENCE


## Протокол

Команды отправляются по сети в слушающий порт сервера. Признаком завершения команды является символ. В ответ на любою команду сервер присылает последовательность O
в случае успеха и ERR messag в случае ошибки с расшифровкой. Для формирования таблиц из условия будут выполнены последовательно следующие команды:

INSERT A 0 lean

< OK

INSERT A 0 understand

< ERR duplicate 0

INSERT A 1 sweater

< OK

INSERT A 2 frank

< OK

...

INSERT B 6 flour

< OK

INSERT B 7 wonder

< OK

INSERT B 8 selection

< OK

В качестве разделителя используется строго один символ пробела. Команды TRUNCATE A и TRUNCATE B очищают соответствующие таблицы.

TRUNCATE A

< OK

INTERSECTION и SYMMETRIC_DIFFERENCE имеют идентичный формат вывода
INTERSECTION

< 3,violation,proposal

< 4,quality,example

< 5,precision,lake

< OK

и

SYMMETRIC_DIFFERENCE

< 0,lean,

< 1,sweater,

< 2,frank,

< 6,,flour

< 7,,wonder

< 8,,selection

< OK


Порядок запуска:

join_server <port>

где • port – номер tcp порта для входящих соединений. Соединения должны обслуживаться с произвольных интерфейсов.



## Требования к реализации

Результатом работы должен стать исполняемый файл join_server и находиться в пакете join_server. Специальных усилий по демонизации сервера выполнять не следует, это значит, что сразу после запуска сервер не возвращает управление до принудительного завершения. Результат работы должен быть опубликован на bintray.



## Проверка

Задание считается выполненным успешно, если после установки пакета и запуска с тестовыми данными вывод соответствует ожиданию.


## Проверка асинхронности

```
./build/join_server 100
```

и в bash запустить команду:

```
# Отправка 150 INSERT A (id 0-149) и 101 INSERT B (id 200-0 с шагом -2)
# Команды TRUNCATE будут перемешаны в общем потоке

# Все INSERT A (прямой порядок)
for i in {0..149}; do 
  (echo "INSERT A $i $(openssl rand -hex 3)" | nc localhost 100) &
done

# Все INSERT B (обратный порядок 200 → 0 с шагом 2)
for i in $(seq 200 -2 0); do  # Изменено здесь!
  (echo "INSERT B $i $(openssl rand -hex 3)" | nc localhost 100) &
done

# TRUNCATE
(echo "TRUNCATE A" | nc localhost 100) &
(echo "TRUNCATE B" | nc localhost 100) &  # Исправлено: было "TRUNCATE B"

wait
```

Примерные выводы после запуска:


```
echo "INTERSECTION" | nc localhost 100 
76,6626ef,be8bc1
78,bf3600,fc0944
80,efaf3f,27bad1
82,8a7461,ae32f7
84,ada0c6,90ed88
86,7ced9f,fb451b
88,1e2648,5a75b7
90,ae882b,b0e660
92,83b52f,3b5ce7
94,88e999,0d037d
96,cf11d0,7060dd
98,ff6f8a,3f53fa
100,6ae66e,bc7dc4
102,6446a5,05ecf2
104,fb1dd2,370503
106,c48a35,2646bb
108,763fa0,22df49
110,f64f4a,a4d6ec
112,a6c075,bc9e47
114,e7e81b,3f4519
116,40d383,2cf6ff
118,a238fd,70fff9
120,5c3b4b,23bd5a
122,1b40c3,f2b754
124,965914,b45f7a
126,669563,56a4b5
128,caed16,ec31c3
130,013ea7,676850
132,ad5d54,48fd59
134,855b4b,6e2627
136,2ae267,1e17d6
138,22a8c1,d35931
140,6e0c18,36f2bf
142,d3f098,54a737
144,4d91eb,062109
146,7c3d6f,5f8000
148,2b9706,4f7c02
OK
```

```
echo "SYMMETRIC_DIFFERENCE" | nc localhost 100 
75,8d79b7,
77,72501c,
79,3279ca,
81,7fb189,
83,8a60cb,
85,7b233d,
87,2d91f3,
89,1a2872,
91,ad2460,
93,2ea622,
95,f3e230,
97,c67d9f,
99,da6438,
101,1c8555,
103,892a8e,
105,1177e1,
107,ac08f1,
109,97d4cd,
111,4a7582,
113,1da6ac,
115,7d5f69,
117,dfaca6,
119,fb2b2a,
121,7b608c,
123,fba0aa,
125,5a59fd,
127,ab0859,
129,7fe608,
131,06a7b0,
133,a34ff3,
135,fa5100,
137,68dd7d,
139,0d7d07,
141,68492c,
143,e81032,
145,45d91a,
147,943fdb,
149,f6718a,
0,,e9d0cb
2,,7cbe6f
4,,257359
6,,44736f
8,,5d1250
10,,8c5216
12,,cdda19
14,,f0bcbc
16,,c01347
18,,e1983d
20,,f47d86
22,,5b28b1
24,,f9c051
26,,829fa0
28,,54f172
30,,673dda
32,,b5266f
34,,6b6987
36,,9a4bf2
38,,57786b
40,,613ce2
42,,af8f28
44,,195816
46,,4d2efe
48,,82f258
50,,805bf3
52,,022243
54,,2c7ef9
56,,f47efd
58,,12d3b6
60,,cfce19
62,,4a1b5c
64,,00e60a
66,,3a6cf1
68,,bae712
70,,41dddb
72,,1a295d
74,,526baf
150,,5f33fd
152,,e4d937
154,,99d3d1
156,,33baae
158,,43c9a0
160,,fad45c
162,,c1b406
164,,27ac3f
166,,494c2a
168,,a33e8d
170,,5ae16b
172,,e729ee
174,,30229e
176,,32c660
178,,bd2367
180,,4862aa
182,,4a6fef
184,,85cdbe
186,,24a892
188,,369493
190,,370ac0
192,,0f8039
194,,9f9d24
196,,f7180c
198,,b1a883
200,,9cc7b6
202,,b1ecbd
204,,201c17
206,,9b0ea7
208,,e6f0e3
210,,0fd5c2
212,,856c7d
214,,904296
216,,814c3a
218,,0d1d7f
220,,79b186
222,,1ad14b
224,,4b2b68
226,,88d6ae
228,,1f22a4
230,,db4de0
232,,7b0b69
234,,0273d4
236,,ff7f14
238,,830963
240,,b2f9b0
242,,57f183
244,,6d6861
246,,5a1a32
248,,4b618c
250,,8c359f
252,,bb533a
254,,c2bdd0
256,,9f2095
258,,c5b875
260,,a31999
262,,72b634
264,,8e468c
266,,c1d47b
268,,d7793c
270,,589f69
272,,5c3ea7
274,,aab696
276,,87624e
278,,416e2b
280,,6baa81
282,,bae18b
284,,4ddb61
286,,8205bd
288,,9be521
290,,5d56ab
292,,ceeb7d
294,,a3b678
296,,5b97b9
298,,f2a7bd
OK
```